import React, { useState, useEffect } from 'react';
import { PieChart, Pie, Cell, ResponsiveContainer, Legend } from 'recharts';
import { Button } from '@/components/ui/button';
import { Card, CardHeader, CardContent } from '@/components/ui/card';

const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8'];

const stenenCategorieen = {
  Respectstenen: [
    'Gelijkwaardigheid', 'Tolerantie', 'Empathie', 'Waardigheid', 'Diversiteit',
    'Inclusiviteit', 'Verdraagzaamheid', 'Beleefdheid', 'Rechtvaardigheid', 'Eerlijkheid'
  ],
  'Ik-stenen': [
    'Zelfontplooiing', 'Authenticiteit', 'Zelfkennis', 'Zelfreflectie', 'Zelfvertrouwen',
    'Persoonlijke groei', 'Individualiteit', 'Zelfrespect', 'Emotionele intelligentie', 'Levenslang leren'
  ],
  'Wij-stenen': [
    'Samenwerking', 'Solidariteit', 'Gemeenschapszin', 'Verbondenheid', 'Sociaal engagement',
    'Dialoog', 'Burgerschap', 'Medemenselijkheid', 'Culturele uitwisseling', 'Collectieve verantwoordelijkheid'
  ],
  Vrijheidsstenen: [
    'Keuzevrijheid', 'Autonomie', 'Zelfbeschikking', 'Vrije meningsuiting', 'Gewetensvrijheid',
    'Persoonlijke vrijheid', 'Onafhankelijkheid', 'Vrij onderzoek', 'Religieuze vrijheid', 'Artistieke vrijheid'
  ],
  Redeneerstenen: [
    'Kritisch denken', 'Rationaliteit', 'Logica', 'Wetenschappelijke methode', 'Objectiviteit',
    'Analytisch vermogen', 'Nieuwsgierigheid', 'Scepsis', 'Bewijsvoering', 'Probleemoplossend denken'
  ],
  Verantwoordelijkheidsstenen: [
    'Ethisch handelen', 'Maatschappelijke betrokkenheid', 'Duurzaamheid', 'Integriteit', 'Verantwoordelijkheidsbesef',
    'Accountability', 'Burgerplicht', 'Zorgzaamheid', 'Moreel kompas', 'Toekomstgerichtheid'
  ]
};

const HumanistischeStenenKiezer = () => {
  const [gekozenStenen, setGekozenStenen] = useState({});
  const [aantalGekozen, setAantalGekozen] = useState(0);

  const toggleSteen = (categorie, steen) => {
    setGekozenStenen(prev => {
      const nieuweGekozen = { ...prev };
      if (!nieuweGekozen[categorie]) nieuweGekozen[categorie] = [];
      
      const index = nieuweGekozen[categorie].indexOf(steen);
      if (index > -1) {
        nieuweGekozen[categorie].splice(index, 1);
      } else if (aantalGekozen < 25) {
        nieuweGekozen[categorie].push(steen);
      }
      return nieuweGekozen;
    });
  };

  useEffect(() => {
    const totaal = Object.values(gekozenStenen).flat().length;
    setAantalGekozen(totaal);
  }, [gekozenStenen]);

  const chartData = Object.entries(gekozenStenen).map(([categorie, stenen]) => ({
    name: categorie,
    value: stenen.length
  })).filter(item => item.value > 0);

  return (
    <div className="p-4">
      <h2 className="text-2xl font-bold mb-4">Humanistische Stenen Kiezer</h2>
      <p className="mb-4">Kies maximaal 25 stenen uit de verschillende categorieÃ«n:</p>
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
        {Object.entries(stenenCategorieen).map(([categorie, stenen]) => (
          <Card key={categorie}>
            <CardHeader>
              <h3 className="text-lg font-semibold">{categorie}</h3>
            </CardHeader>
            <CardContent>
              {stenen.map(steen => (
                <Button
                  key={steen}
                  onClick={() => toggleSteen(categorie, steen)}
                  variant={gekozenStenen[categorie]?.includes(steen) ? 'default' : 'outline'}
                  className="m-1"
                >
                  {steen}
                </Button>
              ))}
            </CardContent>
          </Card>
        ))}
      </div>

      <div className="mb-4">
        <p>Aantal gekozen stenen: {aantalGekozen}/25</p>
      </div>

      {aantalGekozen > 0 && (
        <div className="h-96">
          <ResponsiveContainer width="100%" height="100%">
            <PieChart>
              <Pie
                data={chartData}
                cx="50%"
                cy="50%"
                labelLine={false}
                outerRadius={80}
                fill="#8884d8"
                dataKey="value"
                label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}
              >
                {chartData.map((entry, index) => (
                  <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                ))}
              </Pie>
              <Legend />
            </PieChart>
          </ResponsiveContainer>
        </div>
      )}
    </div>
  );
};

export default HumanistischeStenenKiezer;
